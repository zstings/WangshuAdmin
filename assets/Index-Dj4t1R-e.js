import{a as e,c as t,i as n,l as r,n as i,o as a,r as o,t as s,u as c}from"./css-Bec_zqJs.js";import{i as l,n as u}from"./css-BBNRGxAb.js";import{a as d,r as f}from"./company-K8znEwqs.js";import{Ar as p,Wr as m,Xr as h,Yr as g,_i as _,cr as v,ct as y,gr as b,hr as x,lr as S,mi as C,mr as w,o as T,or as E,s as D,sr as O,ti as k,v as A}from"./index-DQOygbbj.js";function j(e={},t={}){return T(`/user/getContractList`,e,t)}function M(e={},t={}){return D(`/user/addContract`,e,t)}function N(e={},t={}){return D(`/user/deleteContract`,e,t)}function P(e={},t={}){return D(`/user/updateContractStatus`,e,t)}function F(e={},t={}){return D(`/user/updateContractName`,e,t)}var I={class:`search-right-btns`},L={class:`flex-center`},R={class:`flex-center`},z=b({__name:`Index`,setup(_){let{companyList:b}=K(),T=h(),D=h({name:``,type:``,status:``,startTime:``,endTime:``,_startEndTime:[],companyId:``}),z=[{label:`销售合同`,value:1},{label:`采购合同`,value:0}],B=[{label:`已完成`,value:7,type:`success`},{label:`履行中`,value:6,type:`primary`},{label:`待履行`,value:5,type:`info`},{label:`待审核`,value:0,type:`info`},{label:`审核中`,value:1,type:`primary`},{label:`审核失败`,value:2,type:`danger`}],V=g([{key:`name`,type:`el-input`,label:`合同名称`},{key:`type`,type:`el-select`,label:`合同类型`,default:``,options:z},{key:`status`,type:`el-select`,label:`状态`,default:``,options:B},{key:`companyId`,type:`el-select`,label:`所属企业`,config:{value:`id`,label:`name`},options:O(()=>b.value)},{key:`_startEndTime`,type:`el-date-picker`,label:`合同时间`,uiOn:{change:e=>{D.value.startTime=e?.[0]||``,D.value.endTime=e?.[1]||``}}}]);function H(e={}){e._startEndTime=e.startTime?[e.startTime,e.endTime]:[];let i=g(n({id:``,name:``,type:1,price:``,companyId:``,startTime:``,endTime:``,_startEndTime:[],status:`0`},e)),a=new Date,o=[new Date(a.getFullYear(),a.getMonth(),1,0,0,0),new Date(a.getFullYear(),a.getMonth()+1,1,23,59,59)];s({title:`新增合同`,formModel:i,content:()=>x(E,null,[x(u,{label:`合同名称`,prop:`name`,rules:[{required:!0,message:`请输入合同名称`,trigger:[`blur`,`change`]}]},{default:()=>[x(l,{modelValue:i.name,"onUpdate:modelValue":e=>i.name=e,showWordLimit:!0,maxlength:20},null)]}),x(u,{label:`合同类型`,prop:`type`,rules:[{required:!0,message:`请选择合同类型`,trigger:[`blur`,`change`]}]},{default:()=>[x(t,{modelValue:i.type,"onUpdate:modelValue":e=>i.type=e,options:z||[]},null)]}),x(u,{label:`合同金额`,prop:`price`,rules:[{required:!0,message:`请输入合同金额`,trigger:[`blur`,`change`]}]},{default:()=>[x(l,{modelValue:i.price,"onUpdate:modelValue":e=>i.price=e},null)]}),x(u,{label:`合同时间`,prop:`_startEndTime`,rules:[{required:!0,message:`请输入合同时间`,trigger:[`blur`,`change`]}]},{default:()=>[x(r,{modelValue:i._startEndTime,"onUpdate:modelValue":[e=>i._startEndTime=e,e=>{i.startTime=e?.[0]||``,i.endTime=e?.[1]||``}],type:`datetimerange`,"value-format":`YYYY-MM-DD HH:mm:ss`,"range-separator":`至`,"start-placeholder":`开始日期`,"end-placeholder":`结束日期`,"default-time":o},null)]}),x(u,{label:`所属企业`,prop:`companyId`,rules:[{required:!0,message:`请选择所属企业`,trigger:[`blur`,`change`]}]},{default:()=>[x(t,{modelValue:i.companyId,"onUpdate:modelValue":e=>i.companyId=e,options:b.value,props:{value:`id`,label:`name`}},null)]}),i.id&&x(u,{label:`合同状态`,prop:`status`,rules:[{required:!0,message:`请选择合同状态`,trigger:[`blur`,`change`]}]},{default:()=>[x(t,{modelValue:i.status,"onUpdate:modelValue":e=>i.status=e,options:B||[]},null)]})]),okBefore:async()=>{i._startEndTime=void 0,await M(i,{showOKMsg:!0}).then(()=>{T.value?.getData()})}})}function U(t){e.confirm(`确认删除合同[${t.name}]吗？`,`提示`,{confirmButtonText:`确定`,cancelButtonText:`取消`,type:`warning`}).then(()=>{N({id:t.id},{showOKMsg:!0}).then(()=>{T.value?.getData()})})}function W(e){let t=g({id:e.id,name:e.name});s({title:`修改合同名称`,formModel:t,content:()=>x(E,null,[x(u,{label:`合同名称`,prop:`name`,rules:[{required:!0,message:`请输入合同名称`,trigger:[`blur`,`change`]}]},{default:()=>[x(l,{modelValue:t.name,"onUpdate:modelValue":e=>t.name=e,showWordLimit:!0,maxlength:20},null)]})]),okBefore:async()=>{await F(t,{showOKMsg:!0}).then(()=>{e.name=t.name})}})}function G(e){let n=g({id:e.id,status:e.status});s({title:`修改合同状态`,formModel:n,content:()=>x(E,null,[x(u,{label:`合同状态`,prop:`status`,rules:[{required:!0,message:`请选择合同状态`,trigger:[`blur`,`change`]}]},{default:()=>[x(t,{modelValue:n.status,"onUpdate:modelValue":e=>n.status=e,options:B||[]},null)]})]),okBefore:async()=>{await P(n,{showOKMsg:!0}).then(()=>{e.status=n.status})}})}function K(){let e=h([]);return f().then(t=>{e.value=t.list}),{companyList:e}}return(e,t)=>{let n=A,r=d,s=a,l=c,u=i;return p(),S(u,{ref_key:`appTable`,ref:T,modelValue:D.value,"onUpdate:modelValue":t[1]||=e=>D.value=e,"search-config":V,"table-data-api":k(j),okey:`userManagement`},{"search-right":m(()=>[v(`div`,I,[x(n,{type:`primary`,onClick:t[0]||=e=>H()},{default:m(()=>[...t[2]||=[w(`新增合同`,-1)]]),_:1})])]),"table-column":m(()=>[x(s,{label:`合同名称`,align:`center`},{default:m(({row:e})=>[v(`div`,L,[v(`span`,null,C(e.name),1),x(r,{icon:k(y),tip:`修改合同名称`,onClick:t=>W(e)},null,8,[`icon`,`onClick`])])]),_:1}),x(s,{label:`所属企业`,align:`center`},{default:m(({row:e})=>[w(C(k(b).find(t=>t.id==e.companyId)?.name||`--`),1)]),_:1}),x(s,{label:`合同类型`,align:`center`},{default:m(({row:e})=>[w(C(z.find(t=>t.value==e.type)?.label||`--`),1)]),_:1}),x(s,{label:`合同状态`,align:`center`},{default:m(({row:e})=>[v(`div`,R,[x(l,{type:B.find(t=>t.value==e.status)?.type||`danger`,effect:`plain`,size:`small`},{default:m(()=>[w(C(B.find(t=>t.value==e.status)?.label||`--`),1)]),_:2},1032,[`type`]),x(r,{icon:k(y),tip:`修改合同状态`,onClick:t=>G(e)},null,8,[`icon`,`onClick`])])]),_:1}),x(s,{label:`合同金额`,align:`center`},{default:m(({row:e})=>[w(C(e.price||`--`),1)]),_:1}),x(s,{label:`合同时间`,align:`center`},{default:m(({row:e})=>[w(C(e.startTime||`--`)+` 至 `+C(e.endTime||`--`),1)]),_:1}),x(s,{label:`备注`,align:`center`},{default:m(({row:e})=>[w(C(e.remark||`--`),1)]),_:1}),x(s,{label:`创建时间`,align:`center`},{default:m(({row:e})=>[w(C(k(o)(e.createAt)),1)]),_:1}),x(s,{label:`更新时间`,align:`center`},{default:m(({row:e})=>[w(C(e.updateAt?k(o)(e.updateAt):`--`),1)]),_:1}),x(s,{prop:`address`,label:`操作`,align:`center`},{default:m(({row:e})=>[x(n,{type:`primary`,text:``,size:`small`,disabled:e.status==7,onClick:t=>H(e)},{default:m(()=>[...t[3]||=[w(`编辑`,-1)]]),_:1},8,[`disabled`,`onClick`]),x(n,{type:`danger`,text:``,size:`small`,onClick:t=>U(e)},{default:m(()=>[...t[4]||=[w(`删除`,-1)]]),_:1},8,[`onClick`])]),_:1})]),_:1},8,[`modelValue`,`search-config`,`table-data-api`])}}});export{z as default};